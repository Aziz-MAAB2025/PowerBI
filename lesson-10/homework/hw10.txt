ðŸ“˜ Dataset (Lesson 10: Sales Table)
SaleID	ProductID	Amount	Region	SaleDate
1	P1	1200	North	1/5/2023
2	P2	800	South	1/10/2023
3	P1	1500	North	1/15/2023
4	P2	600	East	1/20/2023
ðŸ§  1ï¸âƒ£ What does FILTER(Sales, Sales[Amount] > 1000) return?

It returns a filtered table containing only rows where Amount > 1000.

Resulting table:

SaleID	ProductID	Amount	Region	SaleDate
1	P1	1200	North	1/5/2023
3	P1	1500	North	1/15/2023

âœ… Note: FILTER() does not aggregate â€” it only returns a table object, typically used inside other functions like CALCULATE() or SUMX().

ðŸ’° 2ï¸âƒ£ Write a measure: High Sales (sums Amount where Amount > 1000)
High Sales =
CALCULATE(
    SUM(Sales[Amount]),
    FILTER(Sales, Sales[Amount] > 1000)
)


âœ… This sums Amount only for rows where Amount > 1000.
Result = 1200 + 1500 = 2700

ðŸŒ 3ï¸âƒ£ How does ALLEXCEPT(Sales, Sales[Region]) differ from ALL(Sales)?
Function	Behavior
ALL(Sales)	Removes all filters from the Sales table.
ALLEXCEPT(Sales, Sales[Region])	Removes all filters except Region. That means it keeps Region filters but clears all others (like Product or Date).

Example:
If youâ€™re showing totals by Region, ALLEXCEPT lets you compare within each region, while ALL() compares across all regions.

ðŸ§© 4ï¸âƒ£ Use SWITCH to Categorize Amounts
Amount Category =
SWITCH(
    TRUE(),
    Sales[Amount] > 1000, "High",
    Sales[Amount] >= 500 && Sales[Amount] <= 1000, "Medium",
    "Low"
)


âœ… The TRUE() pattern lets you handle multiple logical conditions cleanly.

Amount	Category
1200	High
800	Medium
1500	High
600	Medium
ðŸŽ¯ 5ï¸âƒ£ What is the purpose of ALLSELECTED?

ALLSELECTED() returns all rows that are visible given the userâ€™s current slicer selections, but it ignores visual-level filters.

âœ… Use Case: When you want percentages or rankings to respect user slicers but not be limited by whatâ€™s currently displayed in a chart or table.

ðŸ“Š 6ï¸âƒ£ Measure: Regional Sales %
Regional Sales % =
DIVIDE(
    SUM(Sales[Amount]),
    CALCULATE(
        SUM(Sales[Amount]),
        ALLEXCEPT(Sales, Sales[Region])
    )
)


âœ… This shows each saleâ€™s contribution to its Regionâ€™s total (not global total).

For Region = North:

Total = 1200 + 1500 = 2700

SaleID 1 â†’ 1200 / 2700 = 44.4%

SaleID 3 â†’ 1500 / 2700 = 55.6%

ðŸ”€ 7ï¸âƒ£ Create a Dynamic Measure (toggle between SUM, AVERAGE, COUNT of Amount)

Assume a slicer table: Metric Selector[Metric] with values:

Metric
Sum
Average
Count

Then create:

Dynamic Amount Measure =
SWITCH(
    SELECTEDVALUE(MetricSelector[Metric]),
    "Sum", SUM(Sales[Amount]),
    "Average", AVERAGE(Sales[Amount]),
    "Count", COUNT(Sales[Amount]),
    BLANK()
)


âœ… The measure changes dynamically depending on the slicer choice.

ðŸš« 8ï¸âƒ£ Use FILTER inside CALCULATE to Exclude "Furniture" Sales

Assume thereâ€™s a related Products table with Category column:

Non-Furniture Sales =
CALCULATE(
    SUM(Sales[Amount]),
    FILTER(Products, Products[Category] <> "Furniture")
)


âœ… Excludes any sales where product category = Furniture.

âš ï¸ 9ï¸âƒ£ Why might ALLSELECTED behave unexpectedly in a Pivot Table?

Because ALLSELECTED depends on the userâ€™s visible selection, it can behave differently if:

The Pivot Table applies additional filters at the visual or subtotal level.

Context changes when users collapse/expand categories or add/removes rows.

âœ… It respects slicers, but visual totals can differ depending on hierarchy or layout.

ðŸŒ ðŸ”Ÿ Write a Measure that Ignores Filters from Region
Total Sales (Ignore Region) =
CALCULATE(
    SUM(Sales[Amount]),
    ALL(Sales[Region])
)


âœ… Removes region-level filters but respects other filters (like Date or Product).

âš¡ 11ï¸âƒ£ Optimize High Sales Measure

Original:

High Sales =
CALCULATE(SUM(Sales[Amount]), FILTER(Sales, Sales[Amount] > 1000))


Optimized (replace FILTER with Boolean filter):

High Sales =
CALCULATE(
    SUM(Sales[Amount]),
    Sales[Amount] > 1000
)


âœ… Simpler and faster because CALCULATE() accepts direct Boolean filters.

ðŸ† 12ï¸âƒ£ Measure: Top 2 Products by Sales
Top 2 Products =
CALCULATE(
    SUM(Sales[Amount]),
    FILTER(
        TOPN(2, SUMMARIZE(Sales, Sales[ProductID], "TotalSales", SUM(Sales[Amount])), [TotalSales], DESC),
        TRUE()
    )
)


âœ… TOPN() ranks the products by sales amount, and this measure sums the top 2.

ðŸ§­ 13ï¸âƒ£ Use ALLSELECTED() with No Parameters
Total Sales (AllSelected) =
CALCULATE(
    SUM(Sales[Amount]),
    ALLSELECTED()
)


âœ… Keeps slicer filters, but ignores visual-level filters or context from specific charts.

ðŸž 14ï¸âƒ£ Debug: SWITCH Measure Returns Incorrect Values in Matrix

Common causes:

The SWITCH uses SELECTEDVALUE() on a field that has multiple values in the current context.
â†’ Result: returns blank or default branch.

Fix: use an explicit aggregator or wrap in HASONEVALUE().

âœ… Example fix:

Metric Logic =
SWITCH(
    TRUE(),
    HASONEVALUE(MetricSelector[Metric]) && SELECTEDVALUE(MetricSelector[Metric]) = "Sum", SUM(Sales[Amount]),
    HASONEVALUE(MetricSelector[Metric]) && SELECTEDVALUE(MetricSelector[Metric]) = "Average", AVERAGE(Sales[Amount]),
    HASONEVALUE(MetricSelector[Metric]) && SELECTEDVALUE(MetricSelector[Metric]) = "Count", COUNT(Sales[Amount]),
    BLANK()
)

ðŸ” 15ï¸âƒ£ Simulate a "Reset Filters" Button using ALL()
Total Sales (Reset Filters) =
CALCULATE(
    SUM(Sales[Amount]),
    ALL(Sales)
)


âœ… Add a button that triggers a bookmark showing this measure or resets slicers â€” mimicking a â€œReset All Filtersâ€ action.

âœ… Lesson 10 Summary
Task	Key Function	Example
Filter table	FILTER(Sales, Sales[Amount]>1000)	Returns filtered rows
High Sales measure	CALCULATE(SUM(...), FILTER(...))	Conditional total
Region filter control	ALLEXCEPT(Sales, Sales[Region])	Keep region context
Categorize Amount	SWITCH(TRUE(),...)	Conditional logic
ALLSELECTED use	Respect slicers, ignore visuals	% contribution
Regional %	ALLEXCEPT(Sales, Sales[Region])	Relative to region
Dynamic measure	SWITCH(SELECTEDVALUE(...))	Slicer-driven logic
Exclude Furniture	FILTER(Products, Products[Category]<>"Furniture")	Conditional filter
Ignore Region	ALL(Sales[Region])	Remove filter
Optimization	Boolean filter instead of FILTER()	Faster calc
Top 2 Products	TOPN() + FILTER()	Ranking
Reset filters	ALL(Sales)	Global total
